version: "3"
services:

  #---------------------------------------------------------------
  # Postgresql Database
  #---------------------------------------------------------------
  db:
    build:
      context: ./data-access-service/docker/postgresql
    image: ulyssejdv/postgresql
    ports:
      - "25432:5432"
    volumes:
      - "/webank/main:/var/lib/postgresql/9.3/main"
    networks:
      - webnet

  #---------------------------------------------------------------
  # Service who communicate with the database
  #---------------------------------------------------------------
  data-access-service:
    build:
      context: ./data-access-service
      dockerfile: ./docker/data-access-service/Dockerfile
      args:
        JAR_FILE: "target/data-access-service.jar"
    image: ulyssejdv/data-access-service
    ports:
      - "25000:25000"
    depends_on:
      - db
    networks:
      - webnet

  #---------------------------------------------------------------
  # Service who communicate with the database second instance
  #---------------------------------------------------------------
  data-access-service-2:
    build:
      context: ./data-access-service
      dockerfile: ./docker/data-access-service-2/Dockerfile
      args:
        JAR_FILE: "target/data-access-service.jar"
    image: ulyssejdv/data-access-service-2
    ports:
      - "25010:25010"
    depends_on:
      - db
    networks:
      - webnet

  #---------------------------------------------------------------
  # load-balancing-soa
  #---------------------------------------------------------------
  load-balancing-soa:
    build:
      context: ./load-balancing-soa
      dockerfile: ./docker/load-balancing-soa/Dockerfile
      args:
        JAR_FILE: "target/load-balancing-soa.jar"
    image: ulyssejdv/load-balancing-soa
    ports:
      - "25030:25030"
    depends_on:
      - data-access-service
      - data-access-service-2
    networks:
      - webnet

  #---------------------------------------------------------------
  # Service who communicate with the android devices
  #---------------------------------------------------------------
  webank-front-android:
    build:
      context: ./webank-front-android
      dockerfile: ./docker/Dockerfile
      args:
        JAR_FILE: "target/webank-front-android.jar"
    image: ulyssejdv/webank-front-android
    ports:
      - "9090:9090"
    depends_on:
      - data-access-service
    networks:
      - webnet

  #---------------------------------------------------------------
  # Service who communicate with the HDFS cluster
  #---------------------------------------------------------------
  webank-hdfs-service:
    build:
      context: ./webank-hdfs-service
      dockerfile: ./docker/Dockerfile
      args:
        JAR_FILE: "target/webank-hdfs-service.jar"
    image: ulyssejdv/webank-hdfs-service
    ports:
      - "25100:25100"
    networks:
      - webnet

  #---------------------------------------------------------------
  # Web App
  #---------------------------------------------------------------
  webapp:
    build:
      context: ./webank-webapp
      dockerfile: ./docker/Dockerfile
      args:
        JAR_FILE: "target/webank-webapp.war"
    image: ulyssejdv/webank-webapp
    ports:
      - "8080:8080"
    depends_on:
      - data-access-service
      - load-balancing-soa
    networks:
      - webnet

networks:
  webnet:

volumes:
  db_data:

